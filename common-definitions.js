// Definitions for common English words (4+ letters)
// This provides basic definitions for cornerstone words

const COMMON_DEFINITIONS = {
  // 4-letter common words found in our puzzle
  "CORE": "The central part of fruit, containing the kernels or seeds.",
  "CORN": "The main cereal plant grown for its grain in a given region, such as oats in parts of Scotland and Ireland, and wheat or barley in England and Wales.",
  "CORNS": "The main cereal plant grown for its grain in a given region, such as oats in parts of Scotland and Ireland, and wheat or barley in England and Wales",
  "CORSE": "A (living) body",
  "CORSET": "A woman's foundation garment, reinforced with stays, that supports the waistline, hips and bust",
  "CORSETS": "A woman's foundation garment, reinforced with stays, that supports the waistline, hips and bust",
  "CORSES": "A (living) body",
  "CORES": "Various former units of volume, particularly:.",
  "CORONET": "A small crown, such as is worn by a noble",
  "CORONETS": "A small crown, such as is worn by a noble",
  "CORNET": "A musical instrument of the brass family, slightly smaller than a trumpet, usually in the musical key of B-flat.",
  "CORNETS": "A musical instrument of the brass family, slightly smaller than a trumpet, usually in the musical key of B-flat.",
  "COST": "To incur a charge of; to require payment of a (specified) price.",
  "COSTS": "To incur a charge of; to require payment of a (specified) price.",
  "COSTER": "Any of various nymphalid butterflies of the genus Acraea.",
  "COSET": "The set that results from applying a group's binary operation with a given fixed element of the group on each element of a given subgroup.",
  "NEON": "The chemical element (symbol Ne) with an atomic number of 10. The lightest of the noble gases, it is a colourless, odorless inert gas.",
  "NEST": "A structure built by a bird as a place to incubate eggs and rear young.",
  "NESTS": "A structure built by a bird as a place to incubate eggs and rear young.",
  "NETS": "A mesh of string, cord or rope.",
  "NONE": "A person without religious affiliation.",
  "NOON": "The ninth hour of the day counted from sunrise; around three o'clock in the afternoon.",
  "NOSE": "A protuberance on the face housing the nostrils, which are used to breathe or smell.",
  "NOSES": "The organs of smell and entrance to the respiratory tract", 
  "NOTE": "(heading) A symbol or annotation.",
  "ONES": "The digit or figure 1.",
  "TOES": "Each of the five digits on the end of the foot.",
  "TONE": "A specific pitch.",
  "TONES": "A specific pitch.",
  "ROSE": "A fragrant flower, typically red, pink, white, or yellow",
  "ROSES": "Fragrant flowers, typically red, pink, white, or yellow",
  "TENS": "The number ten; groups of ten",
  "EONS": "Indefinitely long periods of time",
  "RENO": "An act, or the process, of renovating.",
  "REST": "(of a person or animal) Relief from work or activity by sleeping; sleep.",
  "RESTS": "(of a person or animal) Relief from work or activity by sleeping; sleep.",
  "RETRO": "Past fashions or trends",
  "RETROS": "Past fashions or trends",
  "RETS": "To prepare (flax, hemp etc.) for further processing by soaking, which facilitates separation of fibers from the woody parts of the stem.",
  "ROOT": "The part of a plant, generally underground, that anchors and supports the plant body, absorbs and stores water and nutrients, and in some plants is able to perform vegetative reproduction.",
  "SETS": "To put (something) down, to rest.",
  "SERE": "Without moisture; dry",
  "SNORE": "The act of snoring, and the noise produced",
  "SNORES": "The act of snoring, and the noise produced",
  "SORE": "An injured, infected, inflamed or diseased patch of skin",
  "SORES": "An injured, infected, inflamed or diseased patch of skin",
  "SOREST": "Causing pain or discomfort; painfully sensitive",
  "SORT": "A general type",
  "SORTS": "A general type",
  "SORTES": "Divination, or the seeking of guidance, by chance selection of a passage in the Bible or another text regarded as authoritative",
  "STENO": "A stenographer, someone whose job is to take dictation in shorthand.",
  "STEREO": "A system of recording or reproducing sound that uses two channels, each playing a portion of the original sound in such a way as to create the illusion of locating the sound at a particular position, each offset from the other, thereby more accurately imitating the location of the original sound when the recorded or reproduced sound is heard",
  "STERE": "A measure of volume used e.g. for cut wood, equal to one cubic metre",
  "SOON": "Short in length of time from the present.",
  "TONE": "A specific pitch.",
  
  // 5-letter common words
  "COSTS": "To incur a charge of; to require payment of a (specified) price.",
  "NOTES": "(heading) A symbol or annotation.",
  "NOTRE": "French word meaning 'our'",
  "ROOTS": "The part of a plant, generally underground, that anchors and supports the plant body, absorbs and stores water and nutrients, and in some plants is able to perform vegetative reproduction.",
  "STONE": "A hard earthen substance that can form large rocks.",
  "STORE": "A place where items may be accumulated or routinely kept.",
  "TONER": "Powder used in laser printers and photocopiers to form the text and images on the printed paper.",
  "TONES": "A specific pitch.",
  
  // 6-letter common words
  "CORNER": "The point where two converging lines meet; an angle, either external or internal.",
  "STONES": "A hard earthen substance that can form large rocks.",
  "STORES": "A place where items may be accumulated or routinely kept.",
  
  // 7-letter common words
  "CORNERS": "The point where two converging lines meet; an angle, either external or internal.",
  "SOONEST": "Short in length of time from the present.",
  

  // Additional definitions for Cornerstones puzzle
  "COENO": "A valid English word",
  "COES": "Third person singular of 'coe'",
  "CONE": "A surface of revolution formed by rotating a segment of a line around another line that intersects the first line.",
  "CONER": "One who cones",
  "CONES": "A surface of revolution formed by rotating a segment of a line around another line that intersects the first line.",
  "CONOR": "A masculine given name",
  "COOER": "One who coos",
  "COOERS": "Plural of cooer",
  "COON": "An informal term for raccoon.",
  "COONER": "One who hunts raccoons",
  "COOS": "The murmuring sound made by a dove or pigeon.",
  "COOST": "Past tense of 'coo' (dialectal)",
  "COOT": "Any of various aquatic birds of the genus Fulica that are mainly black with a prominent frontal shield on the forehead.",
  "COOTER": "A freshwater turtle of the eastern United States of the genus Pseudemus.",
  "COOTS": "Any of various aquatic birds of the genus Fulica that are mainly black with a prominent frontal shield on the forehead.",
  "CORER": "A valid English word",
  "CORERS": "A valid English word",
  "CORNERSTONE": "A stone forming the base at the corner of a building.",
  "CORNERSTONES": "A stone forming the base at the corner of a building.",
  "COSE": "A valid English word",
  "COSEN": "A valid English word",
  "COSETS": "The set that results from applying a group's binary operation with a given fixed element of the group on each element of a given subgroup.",
  "COSS": "A valid English word",
  "COSSE": "A valid English word",
  "COSSET": "A pet, especially a pet lamb.",
  "COSTERS": "Any of various nymphalid butterflies of the genus Acraea.",
  "COTE": "A cottage or hut.",
  "COTES": "A cottage or hut.",
  "COTO": "A valid English word",
  "COTS": "A simple bed, especially one for portable or temporary purposes.",
  "CRES": "A valid English word",
  "CRESS": "(plants) A plant of various species, chiefly cruciferous. The leaves have a moderately pungent taste, and are used as a salad and antiscorbutic.",
  "CRESSET": "A metal cup, suspended from a pole and filled with burning pitch etc; once used as portable illumination.",
  "CRESSON": "A valid English word",
  "CREST": "The summit of a hill or mountain ridge.",
  "CRESTS": "The summit of a hill or mountain ridge.",
  "CRETE": "A valid English word",
  "CRONE": "An old woman.",
  "CRONES": "An old woman.",
  "CRONET": "A valid English word",
  "CROON": "A soft or sentimental hum or song.",
  "CROOSE": "A valid English word",
  "CROTON": "Any of various plants, of the genus Croton, that yield croton oil.",
  "ENCORE": "A brief extra performance, done after the main performance is complete.",
  "ENCORES": "A brief extra performance, done after the main performance is complete.",
  "ENORN": "A valid English word",
  "ENOS": "A valid English word",
  "ENROOT": "A valid English word",
  "ENROOTS": "A valid English word",
  "ERST": "First.",
  "ESSE": "A valid English word",
  "ESTER": "A compound most often formed by the condensation of an alcohol and an acid, with elimination of water, which contains the functional group carbon-oxygen double bond joined via carbon to another oxygen atom.",
  "ESTERS": "A compound most often formed by the condensation of an alcohol and an acid, with elimination of water, which contains the functional group carbon-oxygen double bond joined via carbon to another oxygen atom.",
  "ESTOC": "A valid English word",
  "ESTRE": "A valid English word",
  "ETEN": "A valid English word",
  "ETON": "A valid English word",
  "NERTS": "A valid English word",
  "NESS": "A promontory; a cape or headland. (Frequently used as a suffix in placenames.).",
  "NESTER": "One who nests.",
  "NESTERS": "One who nests.",
  "NESTOR": "A valid English word",
  "NETE": "A valid English word",
  "NETER": "A valid English word",
  "NOES": "A negating expression; an answer that shows disagreement or disapproval.",
  "NONES": "A light meal usually eaten around midday, notably when not as main meal of the day.",
  "NONET": "A composition for nine instruments or nine voices.",
  "NOOSE": "An adjustable loop of rope, such as the one placed around the neck in hangings, or the one at the end of a lasso.",
  "NORE": "A valid English word",
  "NORN": "To mourn; complain.",
  "NOSTER": "A valid English word",
  "NOSTOC": "Any member of the genus Nostoc of cyanobacteria, found in a variety of environmental niches, that form colonies composed of filaments of moniliform cells in a gelatinous sheath.",
  "NOTER": "A valid English word",
  "NOTERS": "One who takes notice.",
  "NOTS": "A unary operation on logical values that changes true to false, and false to true.",
  "OCOTE": "A valid English word",
  "OENONE": "A valid English word",
  "ONCOST": "Additional costs; extra expenses.",
  "ONER": "An extraordinary individual.",
  "OOSE": "A valid English word",
  "OOTS": "A valid English word",
  "ORES": "Rock or other material that contains valuable or utilitarian materials; primarily a rock containing metals or gems for which it is typically mined and processed.",
  "ORESTES": "A valid English word",
  "ORNES": "A valid English word",
  "OSSE": "A valid English word",
  "OSSET": "A valid English word",
  "RENONE": "A valid English word",
  "REROOT": "A valid English word",
  "RESTES": "A valid English word",
  "RESTR": "A valid English word",
  "RETE": "A network of blood vessels or nerves.",
  "RETORN": "A valid English word",
  "RETOSS": "A valid English word",
  "ROER": "A valid English word",
  "ROES": "The eggs of fish.",
  "ROESTONE": "A valid English word",
  "RONCO": "A type of fish",
  "RONCOS": "A valid English word",
  "RONE": "A valid English word",
  "ROON": "A valid English word",
  "ROOSE": "A valid English word",
  "ROOST": "The place where a bird sleeps (usually its nest or a branch).",
  "ROOSTER": "A male domestic chicken (Gallus gallus domesticus) or other gallinaceous bird.",
  "ROOSTERS": "A male domestic chicken (Gallus gallus domesticus) or other gallinaceous bird.",
  "ROOSTS": "The place where a bird sleeps (usually its nest or a branch).",
  "ROOTER": "One who, or that which, roots; one that tears up by the roots.",
  "ROOTERS": "One who, or that which, roots; one that tears up by the roots.",
  "ROTE": "Mechanical routine; a fixed, habitual, repetitive, or mechanical course of procedure.",
  "ROTER": "A valid English word",
  "ROTES": "A valid English word",
  "ROTO": "A valid English word",
  "ROTOS": "A valid English word",
  "ROTS": "The process of becoming rotten; putrefaction.",
  "ROTSE": "A valid English word",
  "SENONES": "A valid English word",
  "SENOR": "A Spanish term of address equivalent to sir or Mr., used alone or capitalized and prefixed to the name of a married or an older man.",
  "SENORES": "A Spanish term of address equivalent to sir or Mr., used alone or capitalized and prefixed to the name of a married or an older man.",
  "SEOR": "A valid English word",
  "SERO": "A valid English word",
  "SERON": "A valid English word",
  "SEROON": "A valid English word",
  "SEROOT": "A valid English word",
  "SERT": "A valid English word",
  "SETON": "A few silk threads or horsehairs, or a strip of linen etc., introduced beneath the skin by a knife or needle, so as to induce suppuration; also, the issue so formed.",
  "SETOSE": "Thickly set with bristles or bristly hairs.",
  "SOCO": "A valid English word",
  "SONE": "(acoustics) a subjective unit of loudness for an average listener equal to the loudness of a 1000-hertz sound that has an intensity 40 decibels above the listener's own threshold of hearing.",
  "SONORES": "A valid English word",
  "SOONER": "Short in length of time from the present.",
  "SOONERS": "A valid English word",
  "SOOT": "Fine black or dull brown particles of amorphous carbon and tar, produced by the incomplete combustion of coal, oil etc.",
  "SOOTER": "A valid English word",
  "SOOTS": "Fine black or dull brown particles of amorphous carbon and tar, produced by the incomplete combustion of coal, oil etc.",
  "SOTER": "A valid English word",
  "SOTS": "Stupid person; fool.",
  "SSTOR": "A valid English word",
  "STEN": "A valid English word",
  "STENOS": "A stenographer, someone whose job is to take dictation in shorthand.",
  "STER": "A valid English word",
  "STERN": "Having a hardness and severity of nature or manner.",
  "STERNO": "A valid English word",
  "STERO": "A valid English word",
  "STONER": "One who stones.",
  "STONERS": "One who stones.",
  "STOON": "A valid English word",
  "STOR": "A valid English word",
  "STORER": "A valid English word",
  "STRE": "A valid English word",
  "TENON": "A projecting member left by cutting away the wood around it, and made to insert into a mortise, and in this way secure together the parts of a frame.",
  "TENONER": "A valid English word",
  "TENONERS": "A valid English word",
  "TENOR": "A musical range or section higher than bass and lower than alto.",
  "TENORE": "A valid English word",
  "TERN": "Any of various sea birds of the family Sternidae that are similar to gulls but are smaller and have a forked tail.",
  "TESS": "A valid English word",
  "TOCO": "A pressure-sensitive contraction transducer used in cardiotocography.",
  "TONERS": "Powder used in laser printers and photocopiers to form the text and images on the printed paper.",
  "TOON": "A cartoon, especially an animated television show.",
  "TORC": "A tightly braided necklace or collar, often made of metal, worn by various early European peoples.",
  "TORE": "Hard, difficult; wearisome, tedious.",
  "TORES": "The surface described by the circumference of a circle revolving about a straight line in its own plane.",
  "TORN": "To rend (a solid material) by holding or restraining in two places and pulling apart, whether intentionally or not; to destroy or separate.",
  "TOSS": "A throw, a lob, of a ball etc., with an initial upward direction, particularly with a lack of care.",
  "TOSSER": "One who tosses or throws something.",
  "TRERON": "A valid English word",
  "TRES": "A three-course stringed instrument similar to a guitar; the Cuban variant has six strings, and the Puerto Rican has nine.",
  "TRESS": "A braid, knot, or curl, of hair; a ringlet.",
  "TRESSON": "A valid English word",

  // Add more common word definitions as needed
  // For words without specific definitions, we'll use a generic fallback
};

// Cache for fetched definitions to avoid repeated API calls
const definitionCache = new Map();

// Function to get definition from Free Dictionary API
async function fetchDefinitionFromAPI(word) {
  try {
    const response = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word.toLowerCase()}`);
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    
    const data = await response.json();
    if (data && data.length > 0 && data[0].meanings && data[0].meanings.length > 0) {
      const firstMeaning = data[0].meanings[0];
      if (firstMeaning.definitions && firstMeaning.definitions.length > 0) {
        let definition = firstMeaning.definitions[0].definition;
        
        // Clean up the definition (capitalize first letter, ensure period at end)
        definition = definition.charAt(0).toUpperCase() + definition.slice(1);
        if (!definition.endsWith('.')) {
          definition += '.';
        }
        
        return definition;
      }
    }
    
    throw new Error('No definition found in API response');
  } catch (error) {
    console.warn(`Failed to fetch definition for "${word}":`, error);
    return null;
  }
}

// Function to enhance cornerstone word definitions using LLM
async function enhanceDefinitionWithLLM(word, basicDefinition) {
  try {
    // This would need to be implemented with your preferred LLM service
    // For now, we'll return the basic definition
    // In a real implementation, you might call Claude, OpenAI, etc.
    
    // Example prompt structure for future implementation:
    const prompt = `Improve this dictionary definition to be more clear and engaging for a word game:
Word: ${word}
Current definition: ${basicDefinition}

Provide a concise, clear definition (1-2 sentences) that would help someone understand this word in a word game context.`;
    
    // For now, return the basic definition
    // TODO: Implement actual LLM call when service is available
    return basicDefinition;
  } catch (error) {
    console.warn(`Failed to enhance definition for "${word}":`, error);
    return basicDefinition;
  }
}

// Main function to get definition with API fallback
async function getDefinition(word, isCornerstone = false) {
  const upperWord = word.toUpperCase();
  
  // Check cache first
  if (definitionCache.has(upperWord)) {
    return definitionCache.get(upperWord);
  }
  
  // Check static definitions for common words
  if (COMMON_DEFINITIONS[upperWord]) {
    const definition = COMMON_DEFINITIONS[upperWord];
    definitionCache.set(upperWord, definition);
    return definition;
  }
  
  
  // Try to fetch from Dictionary API
  let definition = await fetchDefinitionFromAPI(word);
  
  if (!definition) {
    // Handle plurals
    if (word.endsWith('s') && word.length > 2) {
      const singular = word.slice(0, -1);
      if (COMMON_DEFINITIONS[singular.toUpperCase()]) {
        definition = "Plural of " + singular.toLowerCase();
      } else {
        const singularDef = await fetchDefinitionFromAPI(singular);
        if (singularDef) {
          definition = `Plural form. ${singularDef}`;
        }
      }
    }
    
    // Final fallback
    if (!definition) {
      definition = "A common English word";
    }
  }
  
  // Enhance definition for cornerstone words
  if (isCornerstone && definition !== "A common English word") {
    definition = await enhanceDefinitionWithLLM(word, definition);
  }
  
  // Cache the result
  definitionCache.set(upperWord, definition);
  return definition;
}

// Synchronous version for backward compatibility
function getDefinitionSync(word) {
  const upperWord = word.toUpperCase();
  
  // Check cache first
  if (definitionCache.has(upperWord)) {
    return definitionCache.get(upperWord);
  }
  
  // Check static definitions
  if (COMMON_DEFINITIONS[upperWord]) {
    return COMMON_DEFINITIONS[upperWord];
  }
  
  
  // Handle plurals
  if (word.endsWith('s') && word.length > 2) {
    const singular = word.slice(0, -1);
    if (COMMON_DEFINITIONS[singular.toUpperCase()]) {
      return "Plural of " + singular.toLowerCase();
    }
  }
  
  // Return fallback - async version will update this later
  return "Loading definition...";
}

// Make functions available globally
if (typeof window !== 'undefined') {
  window.getDefinition = getDefinition;
  window.getDefinitionSync = getDefinitionSync;
  window.fetchDefinitionFromAPI = fetchDefinitionFromAPI;
  window.enhanceDefinitionWithLLM = enhanceDefinitionWithLLM;
  window.WORD_DEFINITIONS = COMMON_DEFINITIONS; // For backward compatibility
  window.COMMON_DEFINITIONS = COMMON_DEFINITIONS;
}

// Export for use in the game
if (typeof module !== 'undefined' && module.exports) {
  module.exports = { COMMON_DEFINITIONS, getDefinition };
}